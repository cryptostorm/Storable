<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSq0Qw3aSRAe15spI8_fDzKHtUqyUtYeE&sensor=true"></script>
<link href='http://fonts.googleapis.com/css?family=Arimo' rel='stylesheet' type='text/css'>
<div id="search-wrapper" style="min-width: 900px; background-color: white; height: 100%;">
  <div style="height:20px"></div>
  <div id="map-canvas" class="awesome-box" style="margin: 20px auto; padding: 10px; width: 750px"></div>
  <% if @listings.count >0 %>
    <div class="awesome-box" style="margin: 0 auto; padding: 10px; width: 750px">
      Results: <%= @listings.count %>
    </div>
  <% end %>
  <div id="results">
    <% if @listings.count >0 %>
      <% @listings.each do |listing| %>
        <div class="search-listing-wrapper">
          <div class="left">
              <a class="search-listing-image-wrapper" href="<%= listing_path(listing) %>"><img width="116px" height="76px" src='<%= listing.images.last.location %>'></img>
              </a>
          </div>
          <div class="left">
            <div class="top">
              <a href="<%= user_path(listing.user)%>" style=' background-image: url(<%= listing.user.profile_photo %>);' class="user-icon left">
              </a>
              <div class="top-info left">
                <a href="<%= listing_path(listing) %>" class="title"><%= listing.title %><span class="new_icon"></span></a>
                <span class="address"><%= listing.location.full_street_address %></span>
              </div>
            </div>
            <div class="bottom">

            </div>
          </div>
          <div class="right">
            <div class="price">$<%=listing.price %></div>
            <div class="address">Per Month</div>
          </div>
        </div>
        <div class="clearfix"></div>
      <% end %>
    <% else %>
      <div id="zero-results" class="awesome-box">
        <h3>Your search yielded 0 results. Here are some possible reasons why:</h3>
        <ul>
          <li> The <b>address</b> you entered could not be found </i>
          <li> There is <b>no available storage space</b> in your area :(</li>
          <li> Your search criteria was too <b>strict</b>!</li>
         </ul>
        <div id="tip">Tip: Try using no filters at first and add more incrementally</div>
      </div>
    <%end %>
  </div>
</div>

<% if @listings.count >0 %>
  <script type="text/javascript">
    function initialize() {
      var mapOptions = {
        center: new google.maps.LatLng(<%= @listings.first.location.latitude %>, <%= @listings.first.location.longitude %>),
        zoom: 11,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("map-canvas"),
          mapOptions);
      <% @listings.each do |listing| %>
        var marker = new google.maps.Marker({
          position: new google.maps.LatLng(<%= listing.location.latitude%>,<%= listing.location.longitude %>),
          title:"<%= listing.title %>",
          map: map,
        });
        var boxText = document.createElement("div");
        boxText.style.cssText = "border: 1px solid black; margin-top: 8px; background: white; padding: 5px;";
        boxText.innerHTML = '<%= listing.description %>';
        var myOptions = {
                   content: boxText
                  ,disableAutoPan: false
                  ,maxWidth: 0
                  ,pixelOffset: new google.maps.Size(-140, 0)
                  ,zIndex: null
                  ,boxStyle: { 
                    background: "white"
                    ,opacity: 1
                    ,width: "280px"
                   }
                  ,closeBoxMargin: "10px 2px 2px 2px"
                  ,closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif"
                  ,infoBoxClearance: new google.maps.Size(1, 1)
                  ,isHidden: false
                  ,pane: "floatPane"
                  ,enableEventPropagation: false
          };
          window.ib = new InfoBox(myOptions);
          ib.open(map, marker);
      <% end %>
    }
    google.maps.event.addDomListener(window, 'load', initialize);
  </script>
<% end %>
